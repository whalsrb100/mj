# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
url --url="http://10.0.0.2/rhel6.4"
#url --url="ftp://10.20.30.1/pub/"

lang en_US.UTF-8
keyboard us
#network --onboot no --device eth0 --bootproto dhcp --noipv6
reboot
rootpw  --iscrypted $6$q/dMm214SL2IV8Rr$C1NgHWB25NAhC2vdbp7pcj0oQSb/4tYVXB3DEw1vRyKJd0yRbR9C745Drmmp0LCX37gMAHIRuO.ha4LzeVO5Z.
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Seoul
#bootloader --location=mbr --driveorder=sda --append="crashkernel=auto"

bootloader --location=mbr --driveorder=sda --append="console=tty0 console=ttyS0,57600 rhgb quiet"

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

#interactive
clearpart --initlabel --all
part /boot       --fstype ext4 --size=500    --ondisk=sda --asprimary
part /           --fstype ext4 --size=40960  --ondisk=sda --asprimary
part swap 		       --size=16384  --ondisk=sda --asprimary
part /home       --fstype ext4 --size=102400 --ondisk=sda
part /log        --fstype ext4 --size=100    --ondisk=sda --grow

#clearpart --initlabel --all
#part /boot --fstype ext4 --size=500 --ondisk=sda --asprimary
#part swap --size=8192 --ondisk=sda --asprimary
#part /PCRF/LOG --fstype ext4 --ondisk=sda --size=2048
#part /PCRF --fstype ext4 --ondisk=sda --size=1024
#part /altibase --fstype ext4 --ondisk=sda --size=1024
#part / --fstype ext4 --size=20480 --ondisk=sda --asprimary
#part /usr --fstype ext4 --size=20480 --ondisk=sda 
#part /var --fstype ext4 --size=15360 --ondisk=sda 
#part /var/crash --fstype ext4 --size=10240 --ondisk=sda 
#part /home --fstype ext4 --size=81920 --ondisk=sda 
#part /logzone --fstype ext4 --size=200 --grow --ondisk=sda 

#part /boot --fstype=ext4 --size=256
#part pv.008002 --grow --size=1

#volgroup VG01 --pesize=4096 pv.008002
#logvol /home --fstype=ext4 --name=home --vgname=VG01 --size=61440
#logvol / --fstype=ext4 --name=root --vgname=VG01 --size=8129 --grow
#logvol swap --name=swap --vgname=VG01 --size=1024
#logvol /usr --fstype=ext4 --name=usr --vgname=VG01 --size=10240
#logvol /usr/local --fstype=ext4 --name=local --vgname=VG01 --size=30720
#logvol /var --fstype=ext4 --name=var --vgname=VG01 --size=61440
#logvol /var/crash --fstype=ext4 --name=crash --vgname=VG01 --size=196608
#logvol /var/crash --fstype=ext4 --name=crash --vgname=VG01 --size=2048
#logvol /workspace --fstype=ext4 --name=workspace --vgname=VG01 --size=1024 --grow
#logvol /log --fstype=ext4 --name=log --vgname=VG01 --size=10240 --grow


firstboot --disable


%packages
@additional-devel
@base
@client-mgmt-tools
@compat-libraries
@console-internet
@core
@debugging
@basic-desktop
@desktop-debugging
@desktop-platform-devel
@development
@dial-up
@ftp-server
@hardware-monitoring
@internet-browser
@java-platform
@korean-support
@large-systems
@legacy-unix
@legacy-x
@system-management-messaging-client
@nfs-file-server
@network-file-system-client
@network-tools
@performance
@perl-runtime
@ruby-runtime
@server-platform
@server-platform-devel
@server-policy
@storage-client-multipath
@system-management
@system-management-messaging-server
@x11
@storage-client-iscsi
@general-desktop
@system-management-snmp
httpd-devel
pcre-devel
libcap-devel
libXinerama-devel
openmotif-devel
net-snmp-devel
libgudev1-devel
kdelibs-apidocs
xz-devel
libtopology-devel
freeglut-devel
kdegraphics-devel
libibverbs-devel
libuuid-devel
kdepimlibs-devel
libblkid-devel
papi-devel
libXmu-devel
unique-devel
xorg-x11-proto-devel
gmp-devel
kdepim-devel
sane-backends-devel
perl-Test-Pod
kdemultimedia-devel
startup-notification-devel
libudev-devel
cups-devel
gstreamer-plugins-base-devel
unixODBC-devel
tcl-devel
numactl-devel
libgnomeui-devel
libbonobo-devel
perl-Test-Pod-Coverage
libtiff-devel
junit
SDL-devel
libXau-devel
tcp_wrappers-devel
PyQt4-devel
kdenetwork-devel
kdelibs-devel
libgcrypt-devel
popt-devel
libusb-devel
hunspell-devel
iptables-devel
libdrm-devel
libXrandr-devel
libxslt-devel
kdebase-devel
tk-devel
libnl-devel
libXpm-devel
expat-devel
e2fsprogs-devel
kdebase-workspace-devel
libglade2-devel
libaio-devel
gnutls-devel
kdesdk-devel
fuse-devel
libXaw-devel
libhugetlbfs-devel
pax
python-dmidecode
sgpio
dos2unix
edac-utils
mtools
ftp
glibc-utils
systemtap-client
memtest86+
gdb-gdbserver
lslk
flightrecorder
systemtap-initscript
oprofile-gui
abrt-gui
xrestop
systemtap-grapher
bltk
kdesdk
gnome-common
qt-doc
gtk2-devel-docs
glade3
desktop-file-utils
gnome-devel-docs
systemtap-sdt-devel
mod_dav_svn
ElectricFence
ant
libstdc++-docs
gcc-gnat
expect
dejagnu
perltidy
cmake
imake
babel
kdewebdev
rpmdevtools
compat-gcc-34
systemtap-server
gcc-java
compat-gcc-34-g77
jpackage-utils
bzr
mercurial
chrpath
gcc-objc
rpmlint
gcc-objc++
compat-gcc-34-c++
python-docs
nasm
xferstats
edac-utils
i2c-tools
lm_sensors
telnet-server
telnet
tcp_wrappers
finger
ncompress
ksh
openmotif
libXmu
libXp
python-saslwrapper
ruby-irb
qpid-tests
ruby-qpid-qmf
wireshark
papi
perl-DBD-SQLite
ruby-irb
ipmitool
watchdog
OpenIPMI
lksctp-tools
net-snmp-perl
net-snmp-python
%end

%post

########## Post Configure / Security Patch For growin #######
NOW=`date +%Y%m%d`
RO=/root/growin/$NOW
mkdir -p $RO


##### Arrange Daemon #####
for stop in $(chkconfig --list | awk '{print $1}' | cut -d : -f 1)
do
chkconfig $stop off
done

DAEMON="acpid arptables_jf auditd avahi-daemon crond gpm haldaemon irqbalance kdump lm_sensors messagebus microcode_ctl netfs network ntpd portmap rsyslog sysstat xinetd telnet vsftpd xfs sshd"

for start in $DAEMON
do
chkconfig $start on
done

##### Network Setting #####
# Configure Bonding Module
/bin/cat << EOF >> /etc/modprobe.d/bonding.conf
alias bond0 bonding
alias bond1 bonding
EOF

# Bonding Network Script
/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond0
DEVICE="bond0"
BOOTPROTO="none"
ONBOOT="yes"
IPADDR="192.168.55.131"
NETMASK="255.255.255.0"
BONDING_OPTS="mode=1 arp_interval=1000 arp_ip_target=192.168.55.145"
USERCTL="no"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1
DEVICE="bond1"
BOOTPROTO="none"
ONBOOT="yes"
IPADDR="1.1.1.131"
NETMASK="255.255.255.0"
BONDING_OPTS="mode=1 arp_interval=1000 arp_ip_target=1.1.1.145"
USERCTL="no"
EOF

#### Vlan ####
/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1.2
DEVICE="bond1.2"
BOOTPROTO="none"                                                                
ONBOOT="yes"
IPADDR="1.1.2.131"
NETMASK="255.255.255.0"
VLAN="yes"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1.3
DEVICE="bond1.3"
BOOTPROTO="none"                                                                
ONBOOT="yes"
IPADDR="1.1.3.131"
NETMASK="255.255.255.0"
VLAN="yes"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1.4
DEVICE="bond1.4"
BOOTPROTO="none"                                                                
ONBOOT="yes"
IPADDR="1.1.4.131"
NETMASK="255.255.255.0"
VLAN="yes"
EOF
#### Vlan ####

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE="eth0"
NM_CONTROLLED="no"
ONBOOT="yes"
MASTER="bond0"
SLAVE="yes"
USERCTL="no"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE="eth1"
NM_CONTROLLED="no"
ONBOOT="yes"
MASTER="bond0"
SLAVE="yes"
USERCTL="no"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth2
DEVICE="eth2"
NM_CONTROLLED="no"
ONBOOT="yes"
MASTER="bond1"
SLAVE="yes"
USERCTL="no"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth3
DEVICE="eth3"
NM_CONTROLLED="no"
ONBOOT="yes"
MASTER="bond1"
SLAVE="yes"
USERCTL="no"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth4
DEVICE="eth4"
NM_CONTROLLED="no"
ONBOOT="no"
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth5
DEVICE="eth5"
NM_CONTROLLED="no"
ONBOOT="no"
EOF

#############################################################################

perl -pi -e 's/HWADDR/#HWADDR/g' /etc/sysconfig/network-scripts/ifcfg-eth*
perl -pi -e 's/NM_CONTROLLED=\"yes\"/NM_CONTROLLED=\"no\"/g' /etc/sysconfig/network-scripts/ifcfg-eth*
perl -pi -e 's/NM_CONTROLLED=yes/NM_CONTROLLED=no/g' /etc/sysconfig/network-scripts/ifcfg-eth*

#############################################################################


# Add Common Rounting Tables 
/bin/touch /etc/sysconfig/network-scripts/route-bond1


##### Additional Network Setting #####
# Add NOZEROCONF
/bin/echo "NOZEROCONF=yes" >> /etc/sysconfig/network

# Cleen DNS Server Config
/bin/cat /dev/null > /etc/resolv.conf

# Setting Telnet Server
/usr/bin/perl -pi -e 's/disable = yes/disable = no/' /etc/xinetd.d/telnet

# Reset NTP
/usr/bin/perl -pi -e 's/^server/#server/g' /etc/ntp.conf

# Setting Loopback Network
/bin/echo "MTU=1500" >> /etc/sysconfig/network-scripts/ifcfg-lo

# Disable Firstboot
echo "RUN_FIRSTBOOT=NO" > /etc/sysconfig/firstboot


### pegasus ADD 0906 ####
/bin/echo "NETWORKING_IPV6=yes" >> /etc/sysconfig/network

#/usr/bin/perl -pi -e 's/^HOSTNAME=localhost.localdomain/HOSTNAME=LBCM1_A/g' /etc/sysconfig/network

# vsftpd root접속 허용
/usr/bin/perl -pi -e 's/^root/#root/'  /etc/vsftpd/ftpusers
/usr/bin/perl -pi -e 's/^root/#root/'  /etc/vsftpd/user_list

# telnet root 접속
for i in $(seq 0 9)
do
echo pts/$i >> /etc/securetty
done

cp /etc/udev/rules.d/70-persistent-net.rules /root/growin/


## ATCA 7360 ##
/bin/cat << EOF > /etc/udev/rules.d/70-persistent-net.rules
KERNEL=="eth*", ID=="0000:01:00.0", NAME="eth0"
KERNEL=="eth*", ID=="0000:01:00.1", NAME="eth1"
KERNEL=="eth*", ID=="0000:0c:00.0", NAME="eth4"
KERNEL=="eth*", ID=="0000:0c:00.1", NAME="eth5"
KERNEL=="eth*", ID=="0000:04:00.0", NAME="eth2"
KERNEL=="eth*", ID=="0000:04:00.1", NAME="eth3"
KERNEL=="eth*", ID=="0000:00:19.0", NAME="eth6"
KERNEL=="eth*", ID=="0000:07:00.0", NAME="eth7"
EOF

## ATCA 7350 ##
#/bin/cat << EOF > /etc/udev/rules.d/70-persistent-net.rules
#KERNEL=="eth*", ID=="0000:0d:04.0", NAME="eth0"
#KERNEL=="eth*", ID=="0000:0d:04.1", NAME="eth1"
#KERNEL=="eth*", ID=="0000:07:00.0", NAME="eth2"
#KERNEL=="eth*", ID=="0000:07:00.1", NAME="eth3"
#KERNEL=="eth*", ID=="0000:0a:04.0", NAME="eth4"
#KERNEL=="eth*", ID=="0000:0a:04.1", NAME="eth5"
#KERNEL=="eth*", ID=="0000:03:00.0", NAME="eth6"
#EOF


## ADD growin ###
/usr/bin/perl -pi -e 's/HISTORY=7/HISTORY=28/g' /etc/sysconfig/sysstat
/usr/bin/perl -pi -e 's/\*\/10/\*/' /etc/cron.d/sysstat

/bin/cat << EOF >> /etc/profile
HISTSIZE=5000
HISTTIMEFORMAT='%F %T   '
export HISTSIZE HISTTIMEFORMAT
EOF
