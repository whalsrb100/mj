# Kickstart file automatically generated by anaconda

#version=DEVEL
install
url --url=http://10.0.0.1/rhel5.6
#nfs --server=172.16.2.1 --dir=/data/iso/rhel5.5
key --skip
lang en_US.UTF-8
keyboard us
xconfig --startxonboot
reboot
network --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted $6$r.B78LInRMaFiyB/$n1W.9h6ksS5cjqfxael7mHjIecUeRT6Dcyocyy54QukNp48a8WCPFns8o.FSU0IwT8PQYDJX3KqJdNBLQSZEJ1
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Seoul
bootloader --location=mbr --driveorder=sda --append="console=tty0 console=ttyS0,115200 crashkernel=128M@16M rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
interactive
clearpart --initlabel --all
part /boot --fstype ext3 --size=100 --ondisk=sda --asprimary
part /		--fstype ext3 --size=20480 --ondisk=sda --asprimary
part swap	--size=8192 --ondisk=sda --asprimary

part /home	--fstype ext3 --size=20480 --ondisk=sda
part /var	--fstype ext3 --size=10240 --ondisk=sda
part /usr	--fstype ext3 --size=20480 --ondisk=sda
part /hegw	--fstype ext3 --size=71680 --ondisk=sda
part /hegw/log	--fstype ext3 --size=200 --ondisk=sda --grow
firstboot --disable


%packages
@admin-tools
@base
@core
@development-libs
@development-tools
@dialup
@editors
@ftp-server
@gnome-desktop
@gnome-software-development
@graphical-internet
@java
@java-development
@korean-support
@legacy-network-server
@legacy-software-development
@legacy-software-support
@network-server
@ruby
@system-tools
@text-internet
@x-software-development
@base-x
system-config-kickstart
tunctl
keyutils
openCryptoki
libhbaapi
brltty
dmraid-events-logwatch
libhbalinux
aide
kexec-tools
nfs4-acl-tools
tpm-tools
gnupg2
iscsi-initiator-utils
trousers
bridge-utils
authd
fipscheck
squashfs-tools
star
hardlink
freeipmi
x86info
device-mapper-multipath
hfsutils
fcoe-utils
edac-utils
hesinfo
fuse-libs
convmv
fuse
cpufreq-utils
openswan
sgpio
systemtap-sdt-devel
perl-XML-SAX
pth
perl-XML-Twig
perl-XML-Dumper
perl-TimeDate
perl-libxml-perl
tog-pegasus-devel
perl-Convert-ASN1
libstdc++44-devel
libassuan-devel
perl-XML-NamespaceSupport
perl-DateManip
libksba-devel
fipscheck-devel
sblim-cmpi-dhcp-devel
perl-Crypt-SSLeay
perl-Mozilla-LDAP
pth-devel
log4cpp-devel
perl-LDAP
perl-XML-Grove
libpciaccess-devel
python-imaging
libhbaapi-devel
python-dmidecode
fuse-devel
libksba
perl-Archive-Zip
gsl
gcc44-c++
gcc44-gfortran
pexpect
dejagnu
imake
java-1.6.0-openjdk-devel
gcc-objc
ElectricFence
memtest86+
gcc-gnat
libgfortran44
gcc44
expect
java-1.6.0-openjdk
unifdef
python-docs
nasm
statserial
efax
emacs-nox
emacs
vim-X11
gnuplot-emacs
nedit
xferstats
libgnome-java
gob2
libgtk-java
libglade-java
libgconf-java
bsh-demo
bogl
bogl-bterm
telnet-server
talk-server
rsh-server
bootparamd
rusers-server
tftp-server
rarpd
gtk+
compat-db
openssl097a
qt4
compat-readline43
compat-openldap
compat-slang
openmotif22
vnc
vnc-server
dnsmasq
dhcp
eruby
ruby-ri
tog-pegasus
lsscsi
pinentry
audit
mc
sysstat
iptraf
xorg-x11-xbitmaps
mesa-libGLw-devel
openmotif-devel
icon-naming-utils
mesa-libGLU-devel
icon-slicer
xorg-x11-server-sdk
libXp-devel
xorg-x11-utils
xorg-x11-xdm
xorg-x11-resutils
xorg-x11-xfwp
xorg-x11-xsm
libpciaccess
xorg-x11-server-Xnest
xorg-x11-xfs-utils
xorg-x11-server-Xvfb
e4fsprogs
arptables_jf

%post





########## Post Configure / Security Patch For growin ##########
NOW=`date +%Y%m%d`
RO=/root/growin/$NOW
mkdir -p $RO

## 2015.07.13
/bin/tar cf /root/growin/etc.tar /etc/

##### Add user (name : suser) #####
/usr/sbin/useradd suser -G wheel
echo "growin" | passwd --stdin suser


##### Arrange Daemon #####
for stop in $(chkconfig --list | awk '{print $1}' | cut -d : -f 1)
do
chkconfig $stop off
done

DAEMON="acpid arptables_jf auditd avahi-daemon crond gpm haldaemon irqbalance kdump lm_sensors messagebus microcode_ctl netfs network ntpd portmap syslog sysstat xinetd telnet vsftpd xfs sshd"

for start in $DAEMON
do
chkconfig $start on
done

# Changing vsftpd banner
/usr/bin/perl -pi -e 's/anonymous_enable=YES/anonymous_enable=NO/g' /etc/vsftpd/vsftpd.conf
/usr/bin/perl -pi -e 's/#ftpd_banner=Welcome to blah FTP service/ftpd_banner=WARNING:Authorized use only/g' /etc/vsftpd/vsftpd.conf


##### Editing /etc/profile #####
/usr/bin/perl -pi -e 's/ulimit -S -c 0 > \/dev\/null 2>&1/ulimit -S -c 20480 > \/dev\/null 2>&1/g' /etc/profile


/bin/cat << EOF >> /etc/profile

# Add umask by growin
umask 022
HISTSIZE=5000
HISTTIMEFORMAT='%F %T   '
export HISTSIZE HISTTIMEFORMAT

EOF



##### Add in /etc/security/limits.conf #####
/bin/cat << EOF >> /etc/security/limits.conf

# Add basic parameter by growin
*		soft	nofile		8192
*		hard	nofile		65535
*		soft	nproc		8192
*		soft	core		20480
EOF



##### Setting Kerenl Parameter #####
# Enable kernel sysrq
/usr/bin/perl -pi -e 's/kernel.sysrq = 0/kernel.sysrq = 1/g' /etc/sysctl.conf

# Add Kernel parameter
/bin/cat << EOF >> /etc/sysctl.conf

# Add Basic Kernel parameter by growin
kernel.msgmni = 1024
kernel.sem = 1000 32000 32 512

net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_syn_retries = 2
net.ipv4.tcp_retries2 = 5

net.core.rmem_default = 4194304
net.core.wmem_default = 4194304
net.core.rmem_max = 8388608
net.core.wmem_max = 8388608
net.ipv4.tcp_mem = 8388608 8388608 8388608

EOF


##### modify sysstat #####
/usr/bin/perl -pi -e 's/HISTORY=7/HISTORY=28/g' /etc/sysconfig/sysstat

/usr/bin/perl -pi -e 's/\*\/10/\*\/1/' /etc/cron.d/sysstat

##### Setting Logrotate #####
# Change logrotate
/usr/bin/perl -pi -e 's/rotate 1/rotate 3/g' /etc/logrotate.conf
/usr/bin/perl -pi -e 's/rotate 4/rotate 12/g' /etc/logrotate.conf
/usr/bin/perl -pi -e 's/0664/0600/g' /etc/logrotate.conf

service syslog restart



##### Configure Kerenl Dump #####
/bin/cat << EOF >> /etc/kdump.conf
path /var/crash
core_collector makedumpfile -c
kdump_pre /root/growin/kdump.sh
extra_bins /bin/bash
EOF

/bin/cat << EOF >> /root/growin/kdump.sh
#!/bin/bash
echo "########## kdump pre execute ##########"
mkdir /test
mount /dev/sda1 /test
echo "########## kdump pre execute ##########" >> /test/file.out
date >> /test/file.out
dmesg >> /test/file.out
EOF

/bin/chmod 777 /root/growin/kdump.sh



##### Network Setting #####
# Configure Bonding Module
/bin/cat << EOF >> /etc/modprobe.conf
alias bond0 bonding
alias bond1 bonding
EOF

# Bonding Network Script
/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond0
DEVICE=bond0
BOOTPROTO=none
ONBOOT=no
IPADDR=
NETMASK=255.255.255.0
GATEWAY=
BONDING_OPTS="mode=1 miimon=100"
USERCTL=no
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1
DEVICE=bond1
BOOTPROTO=none
ONBOOT=no
IPADDR=
NETMASK=255.255.255.0
BONDING_OPTS="mode=1 miimon=100"
USERCTL=no
EOF

##### Additional Network Setting #####
# Add NOZEROCONF
/bin/echo "NOZEROCONF=yes" >> /etc/sysconfig/network

# Cleen DNS Server Config
/bin/cat /dev/null > /etc/resolv.conf

# Setting Telnet Server
/usr/bin/perl -pi -e 's/disable = yes/disable = no/' /etc/xinetd.d/telnet

# Reset NTP
/usr/bin/perl -pi -e 's/^server/#server/g' /etc/ntp.conf

##### ETC #####
# Delete package uucp
/bin/rpm -e uucp

# Disable Firstboot
echo "RUN_FIRSTBOOT=NO" > /etc/sysconfig/firstboot


# yum repository
/bin/cat << EOF > /etc/yum.repos.d/local.repo
[Cluster]
name=Cluster
baseurl=file:///media/Cluster
enabled=1
gpgcheck=0

[ClusterStorage]
name=ClusterStorage
baseurl=file:///media/ClusterStorage
enabled=1
gpgcheck=0

[Server]
name=Server
baseurl=file:///media/Server
enabled=1
gpgcheck=0

[VT]
name=VT
baseurl=file:///media/VT
enabled=1
gpgcheck=0

EOF

echo "ttyS0" >> /etc/securetty
echo "s0:12345:respawn:/sbin/agetty -L 115200 ttyS0 vt100" >> /etc/inittab
