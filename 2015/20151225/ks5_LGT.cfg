# Kickstart file automatically generated by anaconda

#version=DEVEL
install
#nfs --server=10.20.30.1 --dir=/windows/Images/RHEL/rhel5.5_x86_64
#url --url="http://192.168.123.7/iso"

key --skip
lang en_US.UTF-8
keyboard us
#xconfig --startxonboot
#network --device eth0 --bootproto dhcp
reboot
rootpw  --iscrypted $6$r.B78LInRMaFiyB/$n1W.9h6ksS5cjqfxael7mHjIecUeRT6Dcyocyy54QukNp48a8WCPFns8o.FSU0IwT8PQYDJX3KqJdNBLQSZEJ1
firewall --disabled
authconfig --enableshadow --enablemd5
selinux --disabled
timezone Asia/Seoul
#bootloader --location=mbr --driveorder=sda --append="crashkernel=128M@16M rhgb quiet"
bootloader --location=mbr --driveorder=sda --append="console=ttyS0,57600 crashkernel=128M@16M rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#interactive
clearpart --initlabel --all
part /boot       --fstype ext3 --size=512  --ondisk=sda --asprimary
part /           --fstype ext3 --size=40960 --ondisk=sda --asprimary
part swap 		       --size=16384 --ondisk=sda --asprimary
part /home       --fstype ext3 --size=102400 --ondisk=sda
part /CDR        --fstype ext3 --size=51200 --ondisk=sda
part /log        --fstype ext3 --size=100 --ondisk=sda --grow

firstboot --disable


%packages
@admin-tools
@base
@core
@development-libs
@development-tools
@dialup
@editors
@ftp-server
@gnome-desktop
@gnome-software-development
@graphical-internet
@java
@java-development
@korean-support
@legacy-network-server
@legacy-software-development
@legacy-software-support
@network-server
@ruby
@system-tools
@text-internet
@x-software-development
@base-x
system-config-kickstart
tunctl
keyutils
openCryptoki
libhbaapi
brltty
dmraid-events-logwatch
libhbalinux
aide
kexec-tools
nfs4-acl-tools
tpm-tools
gnupg2
iscsi-initiator-utils
trousers
bridge-utils
authd
fipscheck
squashfs-tools
star
hardlink
freeipmi
x86info
device-mapper-multipath
hfsutils
fcoe-utils
edac-utils
hesinfo
fuse-libs
convmv
fuse
cpufreq-utils
openswan
sgpio
systemtap-sdt-devel
perl-XML-SAX
pth
perl-XML-Twig
perl-XML-Dumper
perl-TimeDate
perl-libxml-perl
tog-pegasus-devel
perl-Convert-ASN1
libstdc++44-devel
libassuan-devel
perl-XML-NamespaceSupport
perl-DateManip
libksba-devel
fipscheck-devel
sblim-cmpi-dhcp-devel
perl-Crypt-SSLeay
perl-Mozilla-LDAP
pth-devel
log4cpp-devel
perl-LDAP
perl-XML-Grove
libpciaccess-devel
python-imaging
libhbaapi-devel
python-dmidecode
fuse-devel
libksba
perl-Archive-Zip
gsl
gcc44-c++
gcc44-gfortran
pexpect
dejagnu
imake
java-1.6.0-openjdk-devel
gcc-objc
ElectricFence
memtest86+
gcc-gnat
libgfortran44
gcc44
expect
java-1.6.0-openjdk
unifdef
python-docs
nasm
statserial
efax
emacs-nox
emacs
vim-X11
gnuplot-emacs
nedit
xferstats
libgnome-java
gob2
libgtk-java
libglade-java
libgconf-java
bsh-demo
bogl
bogl-bterm
telnet-server
talk-server
rsh-server
bootparamd
rusers-server
tftp-server
rarpd
gtk+
compat-db
openssl097a
qt4
compat-readline43
compat-openldap
compat-slang
openmotif22
vnc-server
dnsmasq
dhcp
eruby
ruby-ri
tog-pegasus
lsscsi
pinentry
audit
mc
sysstat
iptraf
xorg-x11-xbitmaps
mesa-libGLw-devel
openmotif-devel
icon-naming-utils
mesa-libGLU-devel
icon-slicer
xorg-x11-server-sdk
libXp-devel
xorg-x11-utils
xorg-x11-xdm
xorg-x11-resutils
xorg-x11-xfwp
xorg-x11-xsm
libpciaccess
xorg-x11-server-Xnest
xorg-x11-xfs-utils
xorg-x11-server-Xvfb
e4fsprogs

%post





########## Post Configure / Security Patch For growin ##########
NOW=`date +%Y%m%d`
RO=/root/growin/$NOW
mkdir -p $RO


##### Arrange Daemon #####
for stop in $(chkconfig --list | awk '{print $1}' | cut -d : -f 1)
do
chkconfig $stop off
done

DAEMON="acpid arptables_jf auditd avahi-daemon crond gpm haldaemon irqbalance kdump lm_sensors messagebus microcode_ctl netfs network ntpd portmap syslog sysstat xinetd telnet vsftpd xfs sshd"

for start in $DAEMON
do
chkconfig $start on
done

##### Network Setting #####
# Configure Bonding Module
/bin/cat << EOF >> /etc/modprobe.conf
alias bond0 bonding
alias bond1 bonding
EOF

# Bonding Network Script
/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond0
DEVICE=bond0
BOOTPROTO=none
ONBOOT=yes
IPADDR=192.168.55.
NETMASK=255.255.255.0
GATEWAY=
BONDING_OPTS="mode=1 arp_interval=2000 arp_ip_target=192.168.55.185"
#BONDING_OPTS="mode=1 miimon=100"
USERCTL=no
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1
DEVICE=bond1
BOOTPROTO=none
ONBOOT=yes
IPADDR=1.1.1.
NETMASK=255.255.255.0
BONDING_OPTS="mode=1 arp_interval=2000 arp_ip_target=1.1.1.185"
#BONDING_OPTS="mode=1 miimon=100"
USERCTL=no
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1.2
DEVICE=bond1.2
BOOTPROTO=none
ONBOOT=yes
IPADDR=1.1.2.
NETMASK=255.255.255.0
USERCTL=no
VLAN=yes
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1.3
DEVICE=bond1.3
BOOTPROTO=none
ONBOOT=yes
IPADDR=1.1.3.
NETMASK=255.255.255.0
USERCTL=no
VLAN=yes
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-bond1.4
DEVICE=bond1.4
BOOTPROTO=none
ONBOOT=yes
IPADDR=1.1.4.
NETMASK=255.255.255.0
USERCTL=no
VLAN=yes
EOF


/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
ONBOOT=yes
MASTER=bond0
SLAVE=yes
USERCTL=no
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE=eth1
ONBOOT=yes
MASTER=bond0
SLAVE=yes
USERCTL=no
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth2
DEVICE=eth2
ONBOOT=yes
MASTER=bond1
SLAVE=yes
USERCTL=no
EOF

/bin/cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth3
DEVICE=eth3
ONBOOT=yes
MASTER=bond1
SLAVE=yes
USERCTL=no
EOF


perl -pi -e 's/HWADDR/#HWADDR/g' /etc/sysconfig/network-scripts/ifcfg-eth*

##### Additional Network Setting #####
# Add NOZEROCONF
/bin/echo "NOZEROCONF=yes" >> /etc/sysconfig/network

# Cleen DNS Server Config
/bin/cat /dev/null > /etc/resolv.conf

# Setting Telnet Server
/usr/bin/perl -pi -e 's/disable = yes/disable = no/' /etc/xinetd.d/telnet

# Reset NTP
/usr/bin/perl -pi -e 's/^server/#server/g' /etc/ntp.conf

# Setting Loopback Network
/bin/echo "MTU=1500" >> /etc/sysconfig/network-scripts/ifcfg-lo

# Disable Firstboot
echo "RUN_FIRSTBOOT=NO" > /etc/sysconfig/firstboot

# Serial port configuration
echo "ttyS0" >> /etc/securetty
echo "s0:12345:respawn:/sbin/agetty -L 57600 ttyS0 vt100" >> /etc/inittab

# vsftpd root立加 倾侩
/usr/bin/perl -pi -e 's/^root/#root/'  /etc/vsftpd/ftpusers
/usr/bin/perl -pi -e 's/^root/#root/'  /etc/vsftpd/user_list

# telnet root 立加
for i in $(seq 0 9)
do
echo pts/$i >> /etc/securetty
done

#/usr/bin/perl -pi -e 's/^HOSTNAME=localhost.localdomain/HOSTNAME=070ICSM1B/g' /etc/sysconfig/network


cp /etc/udev/rules.d/70-persistent-net.rules /root/growin/

## ATCA 7360 Series ##
#/bin/cat << EOF > /etc/udev/rules.d/70-persistent-net.rules
#KERNEL=="eth*", ID=="0000:01:00.0", NAME="eth0"
#KERNEL=="eth*", ID=="0000:01:00.1", NAME="eth1"
#KERNEL=="eth*", ID=="0000:0c:00.0", NAME="eth4"
#KERNEL=="eth*", ID=="0000:0c:00.1", NAME="eth5"
#KERNEL=="eth*", ID=="0000:04:00.0", NAME="eth2"
#KERNEL=="eth*", ID=="0000:04:00.1", NAME="eth3"
#KERNEL=="eth*", ID=="0000:00:19.0", NAME="eth6"
#KERNEL=="eth*", ID=="0000:07:00.0", NAME="eth7"
#EOF

## ATCA 7350 ##
/bin/cat << EOF > /etc/udev/rules.d/70-persistent-net.rules
KERNEL=="eth*", ID=="0000:0d:04.0", NAME="eth0"
KERNEL=="eth*", ID=="0000:0d:04.1", NAME="eth1"
KERNEL=="eth*", ID=="0000:07:00.0", NAME="eth2"
KERNEL=="eth*", ID=="0000:07:00.1", NAME="eth3"
KERNEL=="eth*", ID=="0000:0a:04.0", NAME="eth4"
KERNEL=="eth*", ID=="0000:0a:04.1", NAME="eth5"
KERNEL=="eth*", ID=="0000:03:00.0", NAME="eth6"
EOF

## ADD growin ###
/usr/bin/perl -pi -e 's/HISTORY=7/HISTORY=28/g' /etc/sysconfig/sysstat
/usr/bin/perl -pi -e 's/\*\/10/\*\/1/' /etc/cron.d/sysstat
#/usr/bin/perl -pi -e 's/sa1 1 1/sa1 -d 1 1/g' /etc/cron.d/sysstat
#/usr/bin/perl -pi -e 's/sa2 -A/sa2 -A -d/g' /etc/cron.d/sysstat

/bin/cat << EOF >> /etc/profile
HISTSIZE=5000
HISTTIMEFORMAT='%F %T   '
export HISTSIZE HISTTIMEFORMAT
EOF


